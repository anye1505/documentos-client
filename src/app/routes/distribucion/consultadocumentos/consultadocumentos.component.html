<toaster-container [toasterconfig]="toasterconfig"></toaster-container>
<audio controls id="alertaSonido" #alertaSonido style="display:none;"><source src="/assets/sound/SD_NAVIGATE_38.mp3" type="audio/mpeg"></audio>
<div class="panel panel-default">
    <div class="panel-heading">
        <div class="panel-title">Consulta de Documentos</div>
    </div>
    <div class="panel-body">

        <div class="card" role="tabpanel">
            <ul class="nav nav-tabs nav-fill" role="tablist">
                <li class="nav-item" [ngClass]="{'active':panelBusqSeleccionado==-1}" role="presentation">
                    <a class="nav-link" [ngClass]="{'show':panelBusqSeleccionado==-1}" href="javascript:void(0);" (click)="seleccionatab(-1);" aria-controls="home" role="tab" data-toggle="tab" aria-selected="true">
                        <em class="far fa-clock fa-fw"></em>Consulta básica</a>
                </li>
                <li class="nav-item" [ngClass]="{'active':panelBusqSeleccionado==0}" role="presentation">
                    <a class="nav-link" [ngClass]="{'show':panelBusqSeleccionado==0}" href="javascript:void(0);" (click)="seleccionatab(0);" aria-controls="home" role="tab" data-toggle="tab" aria-selected="true">
                        <em class="far fa-clock fa-fw"></em>Consulta múltiple</a>
                </li>
                <li class="nav-item" [ngClass]="{'active':panelBusqSeleccionado==1}" role="presentation">
                    <a class="nav-link" [ngClass]="{'show':panelBusqSeleccionado==1}" href="javascript:void(0);" (click)="seleccionatab(1);" aria-controls="profile" role="tab" data-toggle="tab" aria-selected="false">
                        <em class="far fa-money-bill-alt fa-fw"></em>Por archivo</a>
                </li>
                <li class="nav-item" [ngClass]="{'active':panelBusqSeleccionado==2}" role="presentation">
                    <a class="nav-link" [ngClass]="{'show':panelBusqSeleccionado==2}" href="javascript:void(0);" (click)="seleccionatab(2);" aria-controls="profile" role="tab" data-toggle="tab" aria-selected="false">
                        <em class="far fa-money-bill-alt fa-fw"></em>Por código de destinatario</a>
                </li>
            </ul>

            <div class="tab-content p-0">
                <!--Basico-->

                <div class="tab-pane" [ngClass]="{'active show':panelBusqSeleccionado==-1}" role="tabpanel">
                    <div class="row">     
                        <form [formGroup]="codigo_barra2" class=" form-horizontal col-sm-12 " (submit)="buscar(codigoBarra2, alertaSonido)!">
                            <div class="row">
                                <div class="form-horizontal">                        
                                    <div class="form-group">
                                        <label class="control-label col-sm-1">
                                            C&oacute;digos de barras
                                        </label>
                                        <div class="col-sm-4">
                                            <input class="form-control input-sm" #codigoBarra2 type="text" formControlName="codigoBarra" [formControl]="codigo_barra2.controls['codigoBarra']" />
                                            <span class="text-danger" *ngIf="codigo_barra2.controls['codigoBarra'].hasError('required') && (codigo_barra2.controls['codigoBarra'].dirty || codigo_barra2.controls['codigoBarra'].touched)">Código es obligatorio</span>
                                        </div>

                                        <div *ngIf="permiso" class="col-sm-5 pull-left">
                                            <label class="col-sm-3 control-label">Tipo registro</label>
                                            <div class="col-sm-9">
                                                    <ng-select
                                                    [items]="tiposreg"
                                                    formControlName="tipo"
                                                    [formControl]="codigo_barra2.controls['tipo']" 
                                                    [multiple]="false"
                                                    [closeOnSelect]="true"
                                                    bindLabel="nombre"
                                                    bindValue="id"
                                                    placeholder="Seleccionar"
                                                >
                                                    <ng-template ng-option-tmp let-item="item">
                                                        <div>{{item.nombre}}</div>
                                                    </ng-template>
                                                </ng-select>
                                                <span class="text-danger" *ngIf="codigo_barra2.controls['tipo'].hasError('required') && (codigo_barra2.controls['tipo'].dirty || codigo_barra2.controls['tipo'].touched)">Tipo registro es obligatorio</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-sm-1 text-right pull-right" style="margin-top:15px; margin-right:15px;">
                                    <button [disabled]="loading" class="btn btn-primary" type="submit">Buscar</button>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>

                <!--Multiple-->
                <div class="tab-pane" [ngClass]="{'active show':panelBusqSeleccionado==0}" role="tabpanel">
                    <div class="row">     
                        <form [formGroup]="codigo_barra" class=" form-horizontal col-sm-12 ">
                            <div class="row">
                                <div class="form-horizontal">                        
                                    <div class="form-group">
                                        <label class="control-label col-sm-1">
                                            C&oacute;digos de barras
                                        </label>
                                        <div class="col-sm-4">
                                            <input (ngModelChange)="codigoBarra_keypress(codigoBarra, $event)" class="form-control input-sm" #codigoBarra type="text" formControlName="codigoBarra" [formControl]="codigo_barra.controls['codigoBarra']" 
                                            (keypress)="codigoBarra_keypress(codigoBarra, $event)"/>
                                            <span class="text-danger" *ngIf="codigo_barra.controls['codigoBarra'].hasError('required') && (codigo_barra.controls['codigoBarra'].dirty || codigo_barra.controls['codigoBarra'].touched)">Código es obligatorio</span>
                                        </div>
                                        
                                        <div class="col-sm-1" role="alert alert alert-info" style="margin-bottom:0px;font-size:1.2em;">
                                            <label id="lblManualTotal" class="col-sm-3"></label>
                                        </div>

                                        <div *ngIf="permiso" class="col-sm-5 pull-left">
                                            <label class="col-sm-3 control-label">Tipo registro</label>
                                            <div class="col-sm-9">
                                                    <ng-select
                                                    [items]="tiposreg"
                                                    formControlName="tipo"
                                                    [formControl]="codigo_barra.controls['tipo']" 
                                                    [multiple]="false"
                                                    [closeOnSelect]="true"
                                                    bindLabel="nombre"
                                                    bindValue="id"
                                                    placeholder="Seleccionar"
                                                >
                                                    <ng-template ng-option-tmp let-item="item">
                                                        <div>{{item.nombre}}</div>
                                                    </ng-template>
                                                </ng-select>
                                                <span class="text-danger" *ngIf="codigo_barra.controls['tipo'].hasError('required') && (codigo_barra.controls['tipo'].dirty || codigo_barra.controls['tipo'].touched)">Tipo registro es obligatorio</span>
                                            </div>
                                        </div>
                                    </div>

                                    

                                    <div class="form-group">
                                        <div class="col-sm-offset-1 col-sm-4">
                                            <ul class="list-group" style="max-height:120px;overflow-y: auto;">
                                                <li *ngFor="let item of listcodigosbarra; let i = index"  class="list-group-item" style="padding:4px 6px;">{{item}} 
                                                <div class="pull-right">
                                                <button class="btn btn-xs" (click)="eliminarCodigoLista(i)" type="button" style="margin-top:-2px;"><i class="fa fa-trash"></i></button>
                                                </div>
                                                </li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-sm-1 text-right pull-right" style="margin-top:15px; margin-right:15px;">
                                    <button [disabled]="loading" class="btn btn-primary" type="button" (click)="buscar($event, alertaSonido)!">Buscar</button>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>

            <!--Por archivo-->

                <div class="tab-pane" [ngClass]="{'active show':panelBusqSeleccionado==1}" role="tabpanel">
                    <div class="row">     
                        <form [formGroup]="archivo" class=" form-horizontal col-sm-12 ">
                            <div class="row">
                                <div class="form-horizontal">                        
                                    <div class="form-group">
                                        <div class="col-sm-7">
                                            <label class="control-label col-sm-6 pull-left">                                
                                                Archivo de texto (.txt) con c&oacute;digos de barras</label>
                                            <div class="col-sm-6" >
                                                <label for="file2" class="file-upload">
                                                    <button class="btn btn-primary">Seleccionar Archivo</button>
                                                    <input id="file2" type="file" ng2FileSelect [uploader]="uploader" formControlName="Archivo" [formControl]="archivo.controls['Archivo']"/>
                                                </label>
                                            </div>
                                            <div class="col-sm-4"></div>
                                        </div>
                                        <div *ngIf="permiso" class="col-sm-5 pull-left">
                                            <label class="col-sm-3 pull-left control-label">Tipo registro</label>
                                            <div class="col-sm-9 pull-left">
                                                    <ng-select
                                                    [items]="tiposreg"
                                                    formControlName="tipo"
                                                    [formControl]="archivo.controls['tipo']" 
                                                    [multiple]="false"
                                                    [closeOnSelect]="true"
                                                    bindLabel="nombre"
                                                    bindValue="id"
                                                    placeholder="Seleccionar"
                                                >
                                                    <ng-template ng-option-tmp let-item="item">
                                                        <div>{{item.nombre}}</div>
                                                    </ng-template>
                                                </ng-select>
                                                <span class="text-danger" *ngIf="archivo.controls['tipo'].hasError('required') && (archivo.controls['tipo'].dirty || archivo.controls['tipo'].touched)">Tipo registro es obligatorio</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <br>
                            <div class="row">
                                <div class="form-horizontal">
                                    <div class="form-group" *ngIf="uploader.queue.length > 0 && fileupload == true">
                                        <div class="col-sm-offset-1 col-sm-10">
                                            <table class="table">
                                                <thead>
                                                <tr>
                                                    <th width="50%">Nombre</th>
                                                    <th>Tamaño</th>
                                                    <th>Status</th>
                                                    <th>Acci&oacute;n</th>
                                                </tr>
                                                </thead>
                                                <tbody>
                                                <tr *ngFor="let item of uploader.queue">
                                                    <td><strong>{{ item?.file?.name }}</strong></td>
                                                    <td  nowrap>{{ item?.file?.size/1024/1024 | number:'.2' }} MB</td>
                                                    <td class="text-center">
                                                        <span *ngIf="item.isSuccess"><i class="icon icon-check" style="color:#5cb85c;"></i></span>
                                                        <span *ngIf="item.isCancel"><i class="icon icon-close" style="color:#d9534f;"></i></span>
                                                        <span *ngIf="item.isError"><i class="icon icon-close" style="color:#d9534f;"></i></span>
                                                    </td>
                                                    <td>
                                                        <button [disabled]="loading" class="btn btn-xs bg-danger-dark" (click)="item.remove();" tooltip="Quitar archivo" placement="top" type="button"><i class="fa fa-trash"></i></button>                                                                
                                                    </td>
                                                </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-sm-1 text-right pull-right" style="margin-top:15px; margin-right:15px;">
                                    <button [disabled]="loading" class="btn btn-primary" type="button" (click)="buscar($event, alertaSonido)!">Buscar</button>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>

            <!-- Por destinatario -->

                <div class="tab-pane" [ngClass]="{'active show':panelBusqSeleccionado==2}" role="tabpanel">
                    <div class="row">     
                        <form [formGroup]="destinatario" class=" form-horizontal col-sm-12 ">
                            <div class="row">
                                <div class="form-horizontal">
                                    <div class="col-sm-5">
                                        <div class="form-group pull left">
                                            <label class="col-sm-3 control-label">Operador</label>
                                            <div class="col-sm-9">
                                                <ng-select
                                                    [items]="listoperadores" 
                                                    formControlName="operador" 
                                                    [formControl]="destinatario.controls['operador']" 
                                                    [multiple]="false"
                                                    [closeOnSelect]="true"
                                                    bindLabel="emp_abrev"
                                                    bindValue="emp_id"
                                                    placeholder="Seleccionar"
                                                    (change)="searchCliente($event)"
                                                >
                                                    <ng-template ng-option-tmp let-item="item">
                                                        <div>{{item.emp_abrev}}</div>
                                                    </ng-template>
                                                </ng-select>
                                                <span class="text-danger" *ngIf="destinatario.controls['operador'].hasError('required') && (destinatario.controls['operador'].dirty || destinatario.controls['operador'].touched)">Operador es obligatorio</span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-sm-5">
                                        <div class="form-group">
                                            <label class="col-sm-3 control-label">Cliente</label>
                                            <div class="col-sm-9">                            
                                                <ng-select
                                                    [items]="listclientes" 
                                                    formControlName="cliente"
                                                    [formControl]="destinatario.controls['cliente']" 
                                                    [multiple]="false"
                                                    [closeOnSelect]="true"
                                                    bindLabel="emp_abrev"
                                                    bindValue="cli_id"
                                                    placeholder="Seleccionar"
                                                >
                                                <ng-template ng-option-tmp let-item="item">
                                                    <div>{{item.emp_abrev}}</div>
                                                </ng-template>
                                                </ng-select>
                                                <span class="text-danger" *ngIf="destinatario.controls['cliente'].hasError('required') && (destinatario.controls['cliente'].dirty || destinatario.controls['cliente'].touched)">Cliente es obligatorio</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="form-horizontal">
                                    <div class="col-sm-5">
                                        <div class="form-group pull left">
                                            <label class="control-label col-sm-3">
                                                C&oacute;digo interno
                                            </label>
                                            <div class="col-sm-9">
                                                <input class="form-control input-sm" type="text" formControlName="codigo" [formControl]="destinatario.controls['codigo']" />
                                                <span class="text-danger" *ngIf="destinatario.controls['codigo'].hasError('required') && (destinatario.controls['codigo'].dirty || destinatario.controls['codigo'].touched)">Código es obligatorio</span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-sm-5">
                                        <div class="form-group" *ngIf="permiso">
                                            <label class="col-sm-3 control-label">Tipo registro</label>
                                            <div class="col-sm-9">
                                                    <ng-select
                                                    [items]="tiposreg"
                                                    formControlName="tipo"
                                                    [formControl]="destinatario.controls['tipo']" 
                                                    [multiple]="false"
                                                    [closeOnSelect]="true"
                                                    bindLabel="nombre"
                                                    bindValue="id"
                                                    placeholder="Seleccionar"
                                                >
                                                    <ng-template ng-option-tmp let-item="item">
                                                        <div>{{item.nombre}}</div>
                                                    </ng-template>
                                                </ng-select>
                                                <span class="text-danger" *ngIf="destinatario.controls['tipo'].hasError('required') && (destinatario.controls['tipo'].dirty || destinatario.controls['tipo'].touched)">Tipo registro es obligatorio</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-sm-1 text-right pull-right" style="margin-top:15px; margin-right:15px;">
                                    <button [disabled]="loading" class="btn btn-primary" type="button" (click)="por_destinatario()">Buscar</button>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
        <hr style="margin:21px 0px 15px 0px;" />




        <div class="row" *ngIf="panelBusqSeleccionado!=-1">
            <div class="form-group">
                <div class="col-sm-12">
                    <div style="padding-top: 15px">
                        <a class="pull-rigth" (click)="selectElementContents()" tooltip="Copiar"><span style="color:darkgray;"><em class="pull-rigth fa fa-clone"></em></span></a>
                    </div>
                    
                    <div *ngIf="loading" class="ball-clip-rotate pull-right">
                        <div></div>
                    </div>
                    <div class="table-responsive">
                        <table id="tabletocopy" class="table2 table-striped headbordered tablewrap">
                            <thead>
                            <tr class="headbordered">
                                <th class="text-center" style="width:48px">OS</th>
                                <th class="text-center" style="width:80px">Corte</th>
                                <th class="text-center" style="width:115px">Cód. de barra</th>
                                <th class="text-center" style="width:75px">Despacho</th>
                                <th class="text-center" style="width:80px">Courier</th>
                                <th class="text-center" style="width:75px">Guía</th>
                                <th class="text-center" style="width:80px">Mensajero</th>
                                <th class="text-center" style="width:106px">Gestión</th>
                                <th class="text-center" style="width:80px">Estado</th>
                                <th class="text-center" style="width:80px">F. actualización</th>
                                <th class="text-center" style="width:80px">F. gestión</th>
                                <th class="text-center" style="width:80px">F. carga img</th>
                                <th class="text-center" style="width:82px">Destinatario</th>
                                <th class="text-center" style="width:80px">Dirección</th>                                
                                <th class="text-center" style="width:60px">Nodo</th>
                                <th class="text-center" style="width:80px">Destino</th>
                                <th class="text-center" style="width:80px">Operador</th>
                                <th class="text-center" style="width:70px">Producto</th>
                                <th class="text-center" style="width:58px">Imagen</th>
                                <th class="text-center" style="width:55px">Cargo</th>
                            </tr>
                            </thead>
                            <tbody >
                            <tr *ngFor="let item of rows" id="rowdoubleclick" (dblclick)="onActivate(item)" style="height:50px">
                                <td class="text-center" nowrap style="width:48px">{{ item?.os }}</td>
                                <td class="text-center" nowrap style="width:80px">{{ item?.corte }}</td>
                                <td class="text-center" style="width:115px">{{ item?.codigo_barra }}</td>
                                <td class="text-center" style="width:75px">{{ item?.gud_numero }}</td>
                                <td class="text-center" nowrap style="width:80px">{{ item?.courier }}</td>
                                <td class="text-center" style="width:75px">{{ item?.gui_numero }}</td>
                                <td class="text-center" nowrap style="width:80px">{{ item?.mensajero }}</td>
                                <td class="text-center" style="width:106px">{{ item?.motivo }}</td>
                                <td class="text-center" style="width:80px">{{ item?.estado }}</td>
                                <td class="text-center" style="width:80px">{{ item?.fecha_descarga }}</td>
                                <td class="text-center" style="width:80px">{{ item?.fecha_entrega }}</td>
                                <td class="text-center" style="width:80px">{{ item?.fecha_carga_imagen }}</td>
                                <td class="text-center" nowrap style="width:82px">{{ item?.destinatario }}</td>
                                <td class="text-center" nowrap style="width:80px">{{ item?.direccion }}</td>
                                <td class="text-center" nowrap style="width:60px">{{ item?.nodo }}</td>
                                <td class="text-center" nowrap style="width:80px">{{ item?.destino }}</td>
                                <td class="text-center" nowrap style="width:80px">{{ item?.operador }}</td>
                                <td class="text-center" nowrap style="width:70px">{{ item?.producto }}</td>
                                <td class="text-center" nowrap style="width:58px">{{ item?.tiene_imagen }}</td>
                                <td class="text-center" nowrap style="width:55px">
                                    <div *ngIf="item?.url_imagen" id="cargobutton" style="text-align:center">
                                        <a href="#" id="cargo" (click)="imagepreview(item)" download="{{ item?.codigo_barra }}">
                                            <img class="img-responsive" src="assets/img/cargo.jpeg" alt="img cargo" style="width:auto;height:auto"/>
                                        </a>
                                    </div>
                                </td>
                            </tr>
                            </tbody>
                        </table>
                    </div>


<!--
                    <ngx-datatable id="tabletocopy" #table class='bootstrap no-detail-row' [columns]="columns" [columnMode]="'force'" [footerHeight]="50" [rowHeight]="'auto'" 
                    [limit]="limit" [rows]='rows' (page)="onPage($event)" (sort)="onSort($event)"  [externalPaging]="true" [count]="count"   
                    [externalSorting]="true" [loadingIndicator]="loading" [selected]="selected" [selectionType]="'single'" (activate)="onActivate($event)" 
                    (select)='onSelect($event)' [scrollbarH]="true" [reorderable]="false">
                        
                        <ngx-datatable-column prop="os" name="OS" [sortable]="false" [resizeable]="true" [canAutoResize]="true" [width]="38"></ngx-datatable-column>
                        <ngx-datatable-column prop="codigo_barra" name="Cód. de barra" [sortable]="false" [width]="100"></ngx-datatable-column>
                        <ngx-datatable-column prop="gud_numero" name="Guía Despacho" [sortable]="false" [resizeable]="true" [canAutoResize]="true" [width]="75"></ngx-datatable-column>
                        <ngx-datatable-column prop="motivo" name="Motivo" [sortable]="false" [width]="106"></ngx-datatable-column>
                        <ngx-datatable-column prop="estado" name="Estado" [sortable]="false" [resizeable]="true" [canAutoResize]="true" [width]="106"></ngx-datatable-column>
                        <ngx-datatable-column prop="fecha_descarga" name="F. descarga" [sortable]="false" [resizeable]="true" [canAutoResize]="true" [width]="80"></ngx-datatable-column>
                        <ngx-datatable-column prop="fecha_entrega" name="F. entrega" [sortable]="false" [resizeable]="true" [canAutoResize]="true" [width]="80"></ngx-datatable-column>
                        <ngx-datatable-column prop="fecha_carga_imagen" name="F. carga img" [sortable]="false" [resizeable]="true" [canAutoResize]="true" [width]="80"></ngx-datatable-column>
                        <ngx-datatable-column prop="destinatario" name="Destinatario" [sortable]="false" [width]="82"></ngx-datatable-column>
                        <ngx-datatable-column prop="direccion" name="Dirección" [sortable]="false" [width]="80"></ngx-datatable-column>
                        <ngx-datatable-column prop="destino" name="Destino" [sortable]="false" [width]="106"></ngx-datatable-column>
                        <ngx-datatable-column prop="operador" name="Operador" [sortable]="false" [width]="100"></ngx-datatable-column>
                        
                        
                        
                        <ngx-datatable-column prop="url_imagen" name="Cargo" [sortable]="false" [resizeable]="true" [canAutoResize]="true" [width]="55">
                            <ng-template let-row="row" let-value="value" ngx-datatable-cell-template>

                                <div *ngIf="row.url_imagen" id="cargobutton" style="text-align:center">
                                    <a href="#" id="a" (click)="imagepreview(value)">
                                        <img class="img-responsive" src="assets/img/cargo.jpeg" alt="img cargo" style="width:80%;height:auto"/>
                                    </a>
                                </div>

                            </ng-template>
                        </ngx-datatable-column>

                        <ngx-datatable-footer>
                            <ng-template 
                                ngx-datatable-footer-template
                                let-rowCount="rowCount"
                                let-pageSize="pageSize"
                                let-selectedCount="selectedCount"
                                let-curPage="curPage"
                                let-offset="offset"
                                let-isVisible="isVisible">
                                <div class="page-count"> 
                                    <span *ngIf="selectedMessage">
                                    {{selectedCount.toLocaleString()}} {{selectedMessage}} / 
                                    </span>                                   
                                    <strong>{{rowCount.toLocaleString()}} Total</strong>                
                                    <div class="ball-clip-rotate" style="height:20px;float:right;margin-top: 10px;"  [ngClass]="{hidden : loading !== true }">
                                        <div></div>
                                    </div>
                                </div>
                                <datatable-pager
                                    [pagerLeftArrowIcon]="'datatable-icon-left'"
                                    [pagerRightArrowIcon]="'datatable-icon-right'"
                                    [pagerPreviousIcon]="'datatable-icon-prev'"
                                    [pagerNextIcon]="'datatable-icon-skip'"
                                    [page]="curPage"
                                    [size]="pageSize"
                                    [count]="rowCount"
                                    [hidden]="!((rowCount / pageSize) > 1)"
                                    (change)="table.onFooterPage($event)">
                                </datatable-pager>
                            </ng-template>
                            </ngx-datatable-footer>
                    </ngx-datatable>   
                -->
                </div>
            </div>
        </div>
        <hr style="margin:21px 0px 15px 0px;" />
        <!--<div class="row" *ngIf="selecteddoc">
            <div class="form-group">
                <div class="col-sm-6">
                    <ngx-datatable #table class='bootstrap no-detail-row' [columns]="columns2" [columnMode]="'force'" [footerHeight]="50" [rowHeight]="'auto'" 
                    [limit]="limit2" [rows]='rows2' (page)="onPage($event)" (sort)="onSort($event)"  [externalPaging]="true" [count]="count2"  
                    [externalSorting]="true" [loadingIndicator]="loading2" >
                        <ngx-datatable-column prop="codigo_barra" name="Código de barra" [sortable]="false"></ngx-datatable-column>
                        <ngx-datatable-column prop="fecha" name="Fecha" [sortable]="false"></ngx-datatable-column>
                        <ngx-datatable-column prop="gestion" name="Gestión" [sortable]="false"></ngx-datatable-column>
                        <ngx-datatable-column prop="estado" name="Estado" [sortable]="false"></ngx-datatable-column>
                        <ngx-datatable-column prop="usuario" name="Usuario" [sortable]="false"></ngx-datatable-column>
                        
                        <ngx-datatable-footer>
                            <ng-template 
                                ngx-datatable-footer-template
                                let-rowCount="rowCount"
                                let-pageSize="pageSize"
                                let-selectedCount="selectedCount"
                                let-curPage="curPage"
                                let-offset="offset"
                                let-isVisible="isVisible">
                                <div class="page-count">
                                    <strong>{{rowCount.toLocaleString()}} Total</strong>                
                                    <div class="ball-clip-rotate" style="height:20px;float:right;margin-top: 10px;"  [ngClass]="{hidden : loading2 !== true }">
                                        <div></div>
                                    </div>
                                </div>
                                <datatable-pager
                                    [pagerLeftArrowIcon]="'datatable-icon-left'"
                                    [pagerRightArrowIcon]="'datatable-icon-right'"
                                    [pagerPreviousIcon]="'datatable-icon-prev'"
                                    [pagerNextIcon]="'datatable-icon-skip'"
                                    [page]="curPage"
                                    [size]="pageSize"
                                    [count]="rowCount"
                                    [hidden]="!((rowCount / pageSize) > 1)"
                                    (change)="table.onFooterPage($event)">
                                </datatable-pager>
                            </ng-template>
                            </ngx-datatable-footer>
                    </ngx-datatable>   
                </div>
            </div>
        </div>-->
    </div>
</div>


<div style="overflow-y: scroll;" class="modal fade" bsModal #timelinemodal="bs-modal"  role="dialog" aria-labelledby="timelinemodal" aria-hidden="true" [config]="{backdrop: 'static'}">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title pull-left">Línea de Tiempo</h4>
                <button type="button" class="close pull-right" aria-label="Close" (click)="timelinemodalhide()"  [disabled]="loading2"><span aria-hidden="true">&times;</span></button>
                <br>
                <h5 id="cod_bar"></h5>
            </div>
            <div *ngIf="loading2" class="col-sm-5 ball-clip-rotate pull-center" style="width:40px; height: 40px">
                <div></div>
            </div>
            <div id="divtimeline" style="overflow-y: auto !important; height: 500px !important;" class="modal-body">
                <ul id="ul" [ngClass]="!loading2 && timelineAlt ? 'timeline-alt' : '' ">
                    <li *ngIf="!loading2" class="timeline-separator"></li>
                </ul>
            </div>
        </div>
    </div>
</div>

<form [formGroup]="codigo_barra2" class=" form-horizontal col-sm-12 " (submit)="buscar(codigoBarra3, alertaSonido)!">
<div style="height: auto !important;" class="modal fade" bsModal #consultabasica="bs-modal"  role="dialog" aria-labelledby="consultabasica" aria-hidden="true" [config]="{backdrop: 'static'}">
    <div class="modal-dialog" style="width: 1050px !important;">
        <div class="modal-content">
        
            <div class="modal-header">
                <h4 class="modal-title pull-left">Consulta básica</h4>
                <button type="button" class="close pull-right" aria-label="Close" (click)="consultabasica.hide()"  [disabled]="loading"><span aria-hidden="true">&times;</span></button>
                <div class="row">
                    <div class="col-sm-11">
                        <input class="form-control input-sm" #codigoBarra3 type="text" formControlName="codigoBarra" [formControl]="codigo_barra2.controls['codigoBarra']" placeholder="Código de barras" autofocus/>
                    </div>
                    <div *ngIf="loading" class="col-sm-1 ball-clip-rotate pull-right">
                        <div></div>
                    </div>
                </div>
                
                
            </div>
        
            <div class="modal-body">
                <div class="row">
                    <div class="col-sm-12">                            
                        <div >
                            <table id="tabletocopy" class="table3" style="table-layout:fixed;">
                                <tbody *ngFor="let item of rows3">
                                    <tr id="rowdoubleclick" style="height:50px">
                                        <th class="text-left" style="width:100px">Cód. de barra</th>
                                        <td class="text-left" style="color:#0095ff; font-size: 14px !important;"><b>{{ item?.codigo_barra }}</b></td>
                                        <th class="text-left">Destinatario</th>
                                        <td class="text-left">{{ item?.destinatario }}</td>
                                        <th class="text-left">Guía despacho</th>
                                        <td class="text-left">{{ item?.guia_despacho }}</td>
                                    </tr>

                                    <tr id="rowdoubleclick" style="height:50px">
                                        <th class="text-left" >Operador</th>
                                        <td class="text-left" >{{ item?.operador }}</td>
                                        <th class="text-left">Dirección</th>
                                        <td class="text-left">{{ item?.direccion }}</td>
                                        <th class="text-left">Courier</th>
                                        <td class="text-left">{{ item?.courier_despacho }}</td>
                                    </tr>

                                    <tr id="rowdoubleclick" style="height:50px">
                                        <th class="text-left" >OS operador</th>
                                        <td class="text-left" >{{ item?.os_operador }}</td>
                                        <th class="text-left">Distrito</th>
                                        <td class="text-left">{{ item?.destino }}</td>
                                        <th class="text-left">Fecha despacho</th>
                                        <td class="text-left">{{ item?.fecha_despacho }}</td>
                                    </tr>

                                    <tr id="rowdoubleclick" style="height:50px">
                                        <th class="text-left" >OS</th>
                                        <td class="text-left" >{{ item?.os }}</td>
                                        <th class="text-left">Distrito estandarizado</th>
                                        <td class="text-left">{{ item?.distrito_estandar }}</td>
                                        <th class="text-left">Gestión</th>
                                        <td class="text-left">{{ item?.gestion }}</td>
                                    </tr>

                                    <tr id="rowdoubleclick" style="height:50px">
                                        <th class="text-left" >OS generado en</th>
                                        <td class="text-left" >{{ item?.sucursal_os }}</td>
                                        <th class="text-left" >Guía</th>
                                        <td class="text-left" >{{ item?.guia_numero }}</td>
                                        <th class="text-left">Estado</th>
                                        <td class="text-left">{{ item?.estado }}</td>
                                    </tr>

                                    <tr id="rowdoubleclick" style="height:50px">
                                        <th class="text-left" >Código interno cliente</th>
                                        <td class="text-left" >{{ item?.codigo_cliente }}</td>
                                        <th class="text-left" >Repartidor</th>
                                        <td class="text-left" >{{ item?.repartidor }}</td>
                                        <th class="text-left">F. gestión</th>
                                        <td class="text-left">{{ item?.fecha_gestion }}</td>
                                    </tr>

                                    <tr id="rowdoubleclick" style="height:50px">
                                        <th class="text-left">Fecha corte</th>
                                        <td class="text-left">{{ item?.fecha_corte }}</td>
                                        <th class="text-left">Fecha asignación</th>
                                        <td class="text-left">{{ item?.fecha_asignacion }}</td>
                                        <th class="text-left">F. descargo</th>
                                        <td class="text-left">{{ item?.fecha_descargo }}</td>
                                    </tr>

                                    <tr id="rowdoubleclick" style="height:50px">
                                        <th class="text-left">Fecha OS</th>
                                        <td class="text-left">{{ item?.fecha_os }}</td>
                                        <th class="text-left">Usuario asigna</th>
                                        <td class="text-left">{{ item?.usuario_asigna }}</td>
                                        <th class="text-left">Usuario descarga</th>
                                        <td class="text-left">{{ item?.usuario_descarga }}</td>
                                    </tr>

                                    <tr id="rowdoubleclick" style="height:50px">
                                        <th class="text-left">Cliente</th>
                                        <td class="text-left">{{ item?.cliente }}</td>
                                        <th class="text-left">Fecha salida ruta</th>
                                        <td class="text-left">{{ item?.fecha_entrega_guia }}</td>
                                        <th class="text-left">F. carga img</th>
                                        <td class="text-left">{{ item?.fecha_carga_imagen }}</td>
                                    </tr>

                                    <tr id="rowdoubleclick" style="height:50px">
                                        <th class="text-left">Nodo</th>
                                        <td class="text-left">{{ item?.nodo }}</td>
                                        <th class="text-left">Usuario entrega guía</th>
                                        <td class="text-left">{{ item?.usuario_entrega }}</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-sm-12">
                        <div >
                            <table id="tabletocopy" class="table2 table-striped headbordered " style="table-layout:fixed;">
                                <tbody *ngFor="let item of rows3">
                                    <tr id="rowdoubleclick">
                                        <th class="text-left" style="width:50px !important">Cargo</th>
                                        <td class="text-left" nowrap >
                                            <div *ngIf="item?.url_imagen" id="cargobutton" style="text-align:center">
                                                <a href="#" download="{{ item?.codigo_barra }}.tif" type="media_type">
                                                    <img class="img-responsive" src="{{item?.url_imagen}}" alt="img cargo" style="width:736px;height:600px !important"/>
                                                </a>
                                            </div>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-sm-12">
                        <div>
                            <a class="pull-rigth" (click)="selectElementContents()" placement="right" tooltip="Copiar"><span style="color:darkgray;"><em class="pull-rigth fa fa-clone"></em></span></a>
                        </div>
                    </div>
                </div>
            </div>
        
        </div>
    </div>
</div>
</form>


<div style="height: auto !important;" class="modal fade" bsModal #imgmodal="bs-modal"  role="dialog" aria-labelledby="imgmodal" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div *ngIf="loading2" class="col-sm-5 ball-clip-rotate pull-center" style="width:40px; height: 40px">
                <div></div>
            </div>
            <div id="imagemodal" style="height: auto !important;" class="modal-body">
            </div>
        </div>
    </div>
</div>